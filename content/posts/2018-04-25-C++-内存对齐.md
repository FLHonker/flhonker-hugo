---
title: "C++内存对齐"
date: 2018-04-25T13:22:00+08:00
draft: false
categories: "C++"
tags: ["C++","memory"]
---

## 6. 内存对齐

* 内存对齐的作用：
>(1)平台原因：不是所有的硬件平台都能访问任意内存地址上的任意数据的；某些硬件平台只能在某些地址取得特定类型的数据，否则会抛出硬件异常。
>(2)性能原因：经过内存对齐后，减少了CPU访问内存的总线周期数，速度大大提升。
* 内存对齐规则：
>(1)第一个数据成员放在offset为0的位置，之后的每个数据成员的内存对齐按照#pragma pack(n)指定的值和成员自身长度值中较小的那个进行。【偏移量为其自身大小的整数倍。offset%size==0】
>(2)各数据成员对齐后，类（结构体或联合）也进行对齐，偏移量为最大字段长度的整数倍。
* 关于#pragma pack(n)
> 作为一个预编译命令来设置内存对齐的粒度。n的缺省值是按照编译器自身设置，一般为8，合法数值分别是1,2,4,8,16；若n为其他值是无效的。
![memeroy](https://res.cloudinary.com/flhonker/image/upload/v1525683012/githubio/C-img/%E5%86%85%E5%AD%98%E5%AF%B9%E9%BD%90ex.jpg)